---
name: ğŸ“• Publication of LabCAS-NIST docs website

on:
     push:
         branches:
             - '**'
         paths:
             - 'docs/source/**'
             - '.github/workflows/*.yaml'
             - 'requirements.txt'


jobs:
    publication:
        name: 'ğŸ•¸ï¸ Publication'
        runs-on: ubuntu-latest

        steps:
            -
                name: 'ğŸ’³ Checkout repository'
                uses: actions/checkout@v5
                with:
                    token: ${{github.token}}
            -
                name: 'ğŸ Set up Python 3'
                uses: actions/setup-python@v6
                with:
                    python-version: '3.13'
            -
                name: 'ğŸ§± Install dependencies'
                run: |
                    pip install --quiet --requirement requirements.txt
                    curl --silent --location --output /tmp/deploy.sh https://github.com/X1011/git-directory-deploy/raw/master/deploy.sh
                    chmod +x /tmp/deploy.sh
            -
                name: 'ğŸ§  Generate LinkML documentation'
                run: gen-doc --dialect myst --diagram-type mermaid_class_diagram --directory docs/source/standards/linkml linkml/nist_labcas_linkml.yaml
            -
                name: 'ğŸ–¨ï¸ Build the HTML docs from the Sphinx sources'
                run: sphinx-build --builder html docs/source /tmp/docs
            -
                name: 'ğŸ«¸ Push the built docs to the repository gh-pages branch'
                run: /tmp/deploy.sh --allow-empty --message 'Re-publishing docs to website'
                env:
                    GIT_DEPLOY_DIR: /tmp/docs
                    GIT_DEPLOY_BRANCH: gh-pages
                    GIT_DEPLOY_REPO: origin
...
